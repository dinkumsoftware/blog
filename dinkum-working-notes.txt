dinkum-working-notes.txt
Copyright 2014-2016 Dinkum Software

A running blog-like account of DinkumSoftware's FOSS activity.
https://github.com/dinumsoftware/dinkum-working-notes


A running blog of Dinkum Software's open source development activity
not elsewhere documented.


   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

This is 80 characters.
         1         2         3         4         5         6         7         8
123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789.

2014-03-12 tc@DinkumSoftware.com 

Been struggling for some time with transitioning from subversion with private
servers to open source at git hub and publishing 20+ years of accumulated useful
utilities.

So I'm in that process and I created a public git repo: dinkumsoftware/blog to
hold my working notes until I get my infrastructure stable.  I think I made
an initial mistake naming it blog, thinking that git user dinkumsoftware would
distinguish it.  But it gets "cloned" to just blog.

Now, I made my first mistake, didn't take long.
So all my repos should start with dinkum-.  Kill this blog and recreate it
as dinkumsoftware/dinkum-blog.

Turns out I can rename it in github:

https://help.github.com/articles/renaming-a-repository
Under repo settings

I originally wanted to put all my work under GNU license, but that means
that others can't incorporate it with proprietary software.  While I'm
a long time user of open source stuff, I'm hoping future real-time stuff
gets used by real vendors and GNU would limit it's distribution.

GNU recommended apache 2.0 for non-copyleft, so that's what I'll use for
software:
http://directory.fsf.org/wiki/License:Apache2.0

GNU recommends GFDL for big complicated documentation.
I'll probably use that web pages and manuals:

For really small files, GNU recommends:
https://www.gnu.org/prep/maintain/html_node/License-Notices-for-Other-Files.html

GIT only "knows about Apache 2.0, So for now I'll put everything under that.

I'm writing in Markdown, so I ought to know a little about it.
http://guides.github.com/overviews/mastering-markdown/

I made some initial wiki pages using on-line editor.
For now, just keeping the blog in the readme.md.  github has capability to
generate html (under dinkumsoftware.org if I want).  I'll need to explore that
sometime.

Enough for tonite.

2014-03-13 tc@DinkumSoftware.com 

The general thrust here is to do open source python development.  I need
reasonable project structure for python.  I'm mucked around a bit over the
last year without coming up with my own solution.  Found a great web site
that generally covers it all:
http://www.jeffknupp.com/blog/2013/08/16/open-sourcing-a-python-project-the-right-way/

I'm in agreement with most of the things he says and he lead me to
cookiecutter which seems like a great solution for generating project
templates and use on line resources for testing, packaging, and
distributing python code.  I want to eventually end up with
dinkum-project a python "package" with some executables that let me
generate a new project with a one-liner, allow refactoring between
projects etc.  But I need small steps.

So near term goal: MOVED to line 150

As I am writing markdown for my first time, I git pushed and had a couple of
problems.
DONE

   - [x] the mention of jeffknupp wasn't highlighted.
         Turns out @mentions only work in descriptions and comments of
         Issues and Pull requests.
   - [x] the formatting of my near term goals all ran together.

Struggling with MarkDown.  GitHub has some GitHub only MarkDown enhancements.
Some of them only show up in descriptions/comments in Issues/Pull requests.
i.e. not this file.  Some seems to work in all files (like this one).

Apparently regular markdown (like html, etc) treat a new-line as regular white
space.  GitHub treats a new-line differently.  Now my problem is that my brain
is hardwired to hit enter at the edge of a screen in emacs and github renders it
to that width.  For now, keep my emacs window at 80 columns and keep hitting
the enter key.

Where's the MarkDown documentation?
[GitHub Documentation]
        (https://help.github.com/categories/88/articles)

Where's the "official" markdown reference?   Well according to (wikipedia)
[http://en.wikipedia.org/wiki/Markdown] there isn't any standard.  Note
that there is an emacs plugin. TODO

-[ ] get emacs markdown plugin

GFM github flavored markdown seems popular.

Here is a [live online Markdown Here page]
     (http://markdown-here.com/livedemo.html)
It is yet another variant of markdown,
but it follows GFM conventions on new lines. @adam-p

[John Gruber, the original authors spec]
      (http://daringfireball.net/projects/markdown/syntax)

My todo marker has historically been todo inside of angle brackets, but it
disappears.  Since you can write in-line html, MarkDown gobbles up what
look like html tags.  So I need to change my todo marker.

What does eclipse use by default?  Looks like todo(all caps) .. use that.
Follow the GFM task list convention for todo's even though it
doesn't seem to work in Markdown files in the project (like this one).  It
is still readable.

Fixed up the formatting for short term dinkum-sandbox list.

Made some dinkum markdown rules on wiki

2014-03-14 tc@DinkumSoftware.com 

Pop the stack a bit to:

So near term goal: TODO

- repo:dinkum-sandbox
  - executables:
    - *dinkum_sandbox_hello.py*      prints hello
    - *dinkum_sandbox_goodbye.py*    prints goodbye
  - shared code:
    - *sandbox.py*                   common code, in sandbox package?
                                     or dinkum.sandbox package?

End of the chain is cookiecutter.

Everything in a virtual environment.
virtualenvwrapper installs other packages.

    pip install virtualenvwrapper
no pip.

    sudo apt-get install python-pip
I put this on wiki under Dinkum Project OS packages required.

  pip install virtualenvwrapper:
Installed /home/tc/projects/dinkum-blog/build/virtualenvwrapper/pbr-0.6-py2
  error: /usr/local/lib/python2.7/dist-packages/virtualenvwrapper: Permission denied
Storing complete log in /home/tc/.pip/pip.log

It left the build directory behind.
Looks like it needs to be root for installing into system directories.

      sudo pip install virtualenvwrapper

worked, cleaned up build directory.
Now diddle my .bashrc
http://virtualenvwrapper.readthedocs.org/en/latest/install.html says:
''''
export WORKON_HOME=$HOME/.virtualenvs
export PROJECT_HOME=$HOME/Devel
source /usr/local/bin/virtualenvwrapper.sh
````
http://www.jeffknupp.com/blog/2013/08/16/open-sourcing-a-python-project-the-right-way/ says:
````
$ echo "source /usr/local/bin/virtualenvwrapper.sh" >> ~/.zshrc
````

There is a default of .virtualenvs built into virtualenvwrapper.sh.
That works for me.  There is no default for PROJECT_HOME, I want it to be
projects.
```
cat <<EOF >> ~/.bashrc

# virtualenvwrapper setup
export PROJECT_HOME=$HOME/projects
source /usr/local/bin/virtualenvwrapper.sh
EOF
source ~/.bashrc

```

virtualenv doesn't appear to have man pages.

Ubuntu 12.04.02LTS package: virtualenvwrapper

Made a wiki page for a cheat sheet:

https://github.com/dinkumsoftware/dinkum-blog/wiki/_new?wiki[name]=virtualenvwrapper

enuf for now.

All the wiki pages look good, but.... this file is managled.
I need to rethink whether I want to blog and/or do workin notes in markdown.
Maybe should revert to text? Or maybe stay in markdown but put everything
in a block?... think of these things.  It might help once I have emacs markdown.

2014-03-15 tc@DinkumSoftware.com 

Decided to "blog" in pure text instead of markdown.  Even when markdown becomes
second nature, i still adds an extra step of generating the markdown and
proofing it.  Only downside is (a) links aren't alive and (b) isn't as pretty
on the net.  A price to pay.

So move this file to dinkum-blog/dinkum-blog.txt
and fix up README.md to point to (a) blog and (b) wiki

2014-03-25 tc@DinkumSoftware.com 

Working on setting up servers and documenting the tips.

2016-05-08 tc@DinkumSoftware.com 

After a brief pause (2 yrs) getting back to publishing and moving all my
code from private subversion to github.  Hopefully I can get farther this
time.

I'm going to have one hopefully massive repo in github/dinkum for now.
Later I can package individucal pieces.  I'm keeping running working notes
(this file) in a separate repo only to avoid agony when I switch branches.
It avoids premature commits and/or stashes.

Decided to publish tc@DinkumSoftware.com as timestamp on files.  I thought
I always avoided it but, turns out it was in this file.  Couldn't face
setting up another email address and now I don't have to edit software
that I publish.  We'll see if email traffic builds with (a) real users or
(b) more likely spam.

I'm also setting up a new computer (casey) at the same time.
I'll transfer exist paper notes to casey-setup.txt.

Git setup <todo> move to dinkum

git config --global  user.name    <your name>
git config --global  user.email   <your email>
git config --global  core.editor   emacs
git config --global  merge.tool    meld
git config --global  diff.guitool  meld
git config --global  merge.cmd=meld $LOCAL $MERGED $REMOTE --output $MERGED
                                            # control windows presented on
                                            # a merge.
git config --global  difftool.prompt=false
git config --global  push.default matching  # Allow push to non-upstream
                                            #repo of same name as local
git config --global  credential.helper=cache --timeout=28800
                                            # How long git remembers passwd


<todo> kill the working notes wiki by moving content into dinkum.

Working on the private site to mount a bunch of usb disks.

Also got ssh timing out with:
tc@luna:~$ Write failed: Broken pipe

ServerAliveInterval
         Sets a timeout interval in seconds after which if no data has
         been received from the server, ssh(1) will send a message through
         the encrypted channel to request a response from the server.  The
         default is 0, indicating that these messages will not be sent to
         the server.  This option applies to protocol version 2 only.

ServerAliveCountMax

	by default this is set to 3. Therefore once the
	ServerAliveInterval has sent 3 small packs of info to your
	server it will then automatically log out. Setting it to 1200
	means this process will have to occur at least 1200 times. In
	short you should be connected at least more than 12 days.

Fixed via:
    /etc/ssh/ssh_config
        Host *
	# 3 days (2 min * 2160 tries)
	ServerAliveInterval  120
	ServerAliveCountMax 2160

2016-05-10
committed root-rsync-push

Looks like the FQDN doesn't work on my servers.
Looks like two possible fixes:
    /etc/resolv.conf    (or actually another file as it is built dynamically)
    or /etc/hosts       on the 127.0.1.1 line

Try:
    /etc/hosts
        127.0.1.1	bert   ===>
        127.0.1.1	bert.DinkumSoftware.com bert
                        # ORDER important. fqdn must come first

That worked.

But bert has a static IP.
Try:
    /etc/hosts
	50.78.19.59    bert.DinkumSoftware.com bert

That seemed to fail. Probably want to specify the IP somewhere in the network or the like.

Add 127 line to casey-setup and newly created server-setup

  On bert, the following fails
    sudo su
    ssh localhost

Because I have 

/etc/ssh/sshd-config
#PasswordAuthentication yes
PermitRootLogin without-password
#PermitRootLogin yes

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the ChallengeResponseAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via ChallengeResponseAuthentication may bypass
# the setting of "PermitRootLogin without-password".
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and ChallengeResponseAuthentication to 'no'.
UsePAM yes

I want:

PermitRootLogin                 without-password  # default
ChallengeResponseAuthentication no                # default
PasswordAuthentication          no		  # uncomment and edit yes=>no
UsePAM                          yes		  # default

IMPORTANT! You must ssh-copy-id FIRST!
So all I have to do is change is:
PasswordAuthentication          no		  # uncomment and edit yes=>no

# Allow ssh from tc to root
# drwx------ 2 tc tc 4096 May 10 16:43 /home/tc/.ssh
# -rw------- 1 tc tc  404 May 10 16:41 /home/tc/.ssh/authorized_keys

sudo mkdir -p                              /root/.ssh
sudo chmod 700                             /root/.ssh
sudo touch                                 /root/.ssh/authorized_keys
cat /home/tc/.ssh/id_rsa.pub | sudo tee -a /root/.ssh/authorized_keys > /dev/null
sudo chmod 600                             /root/.ssh/authorized_keys

Move this to casey-setup and server-setup

2015-05-18 tc@DinkumSoftware.com 
renamed root-rsync-mirror-push dinkum-root-rsync-mirror-push 


<todo> deploy it to luna, ernie, bert in /usr/local/sbin and test it.

2016-05-20

Installed wireshark.
Was about to put myself in wireshark group to avoid running it as root as suggested by
the documentation.... but there is no group wireshark.


https://ask.wireshark.org/questions/7523/ubuntu-machine-no-interfaces-listed
$ sudo apt-get install wireshark
$ sudo dpkg-reconfigure wireshark-common 
$ sudo usermod -a -G wireshark $USER
$ sudo reboot


2016-05-30
Python plotting librarys:
    matplotlib
    Pyqtgraph
    plot.ly


2016-06-12 tc@DinkumSoftware.com
Installed zenmap
    
2016-10-26

Back from summer of sailing.  Fixing up svn.
Installed subversion on casey.

Prior work in svn-recovery-2015-01-02.readme.txt

Try to checkout:
svn checkout svn+ssh://eth0.bert.dinkumsoftware.com/home/tc/network-services/svn svn-root
It worked.  I must have fixed it before. (dump before error, dump after error, load together)

Never easy....
The file count under active doesn't match via find -type f | wc -l
  active:
    casey:    23096		13G
    orphan:   42094		25G
  yesterday's news:
    casey:    937		9.2G		
    orphan:   not present


ssh ernie;cd /home/dinkum/opt
[tc@ernie opt]$ svnadmin verify svn
svnadmin: Reading one svndiff window read beyond the end of the representation

ssh bert; cd network-services
svnadmin verify svn
* Verified revision 1513.


<todo> clean up:
    ernie: /home/dinkum/opt/svn-recovery
    luna: ~data/svn-root
    bert: ~/network-services/svn ?

So... ernie did not get fixed, but yet I can check out
all of svn from ernie without an error.  Must be
a client side change on casey.... but serious difference in file size.


Check it out from bert
svn checkout svn+ssh://eth0.bert.dinkumsoftware.com/home/tc/network-services/svn/trunk svn-root-bert

2016-10-27 tc@DinkumSoftware.com

svn on bert and ernie differ.  Makes senses as there have been commits to ernie since then.
wait... everything is pointing to bert, including orphan.
So why did diff produce differences?

OK.... so call bert the gospel svn.
checkout both the active/yesterdays-news to casey:


tc@casey:~/projects$ svn checkout svn+ssh://eth0.bert.dinkumsoftware.com/home/tc/network-services/svn/trunk/active svn-root-active
		     svn checkout svn+ssh://eth0.bert.dinkumsoftware.com/home/tc/network-services/svn/trunk/yesterdays-news  svn-root-yesterdays-news

<fixed> External disk isn't working.  It gets an error when you to write to it


<todo> Rest of orphan to xfer:
       Pictures (desktop mostly), Ernie pictures to bert?
       emacs settings (compare against svn)
       bin (compare against svn/git)
       encrypted bin
       Desktop

<todo> check bert firewall setting, shut down all and switch to vpn.

2016-11-01 tc@DinkumSoftware.com

meganet is retiring cape.com.  I should use the opportunity to switch ISPs, but first I'll convert.
They are mapping:
    X@cape.com => X@meganet.net
    X@dinkumsoftware.com => Y@cape.com => Y@meganet.net
Servers:
    pop.meganet.net
    smtp.meganet.net
Same username/password
They are mapping X@dinkumsoftware.com addresses, so don't have to tell anyone externally.


General email plan: <todo>
x   get casey thunderbird email working with meganet addresses
x   switch my phone and tablet
        <todo>
        can't send mail from phone reliably.  Works sometimes. (tablet works ok).  There is an icon on failure.
x   tell debbie about the switch, url: meganet.net/cape-email-conversion for instructions
    transfer all of orphan email to casey (thunderbird to thunderbird)
    transfer some mailing lists
x   finish up orphan empty
    transfer all of nellie email to casey (disk swap)
    switch email providers: (maybe search archived mail for others)
        2 pop boxes
        tc:     vendor content nic-guru hello bcc jedgar
	debbie:
	Less than or equal to meganet charges
    set up imap server on bert

2016-11-09
Setting up emacs in git and casey/toms-pc

In svn:
    backups/tilde_tc/_DINKUM_DOT__.tc-toolbox
	             _DINKUM_DOT_.emacs
To git (dinkum):
   emacs
     README.txt
     bin/dinkum-install-tc-emacs
     tc-init.emacs
     tc-lisp/*.el

Deployed (by dinkum-install-tc-emacs)
   ~/.emacs.d/init.el    (load "~/.emacs.d/tc-init.emacs")
   ~/.emacs.d/tc-init.emacs
   ~/.emacs.d/tc-lisp/*.el


To cleanup:
    svn-root-active/backups/tilde_tc ==>
    svn-root-yesterdays-news/to-git/backups/tilde_tc

2016-11-10
Debugging emacs customizations.
Support name and directory changes
bug fix.  previous-window wasn't working.  Had to rename it to
tc-previous-window to avoid name collision with internal emacs function.

Function keys didn't work in emacs. emacs wasn't seeing F<n>.
Turns out on dell xps, F<n> does some system specific function.
If one holds down the Fn key while pressing F<n>, emacs sees it.
One can change the default behavior to make F<n> passed thru to
application the default and holding down the Fn key invokes the
hardware function. To alter:

    reboot and pound on F12
    Post Behavior
        FN Lock    CHECK    ; Fn+Esc toggles primary/secondary use of F<n>

        Lock Mode Disable/Standard        ; F<n> does media stuff
                                          ; Fn F<n> passed thru to application
        Lock Mode Disable/Secondard CHECK ; F<n> passed thru to application
                                          ; Fn F<n> required for media

date-stamp.el
    switched back to yyyy-mm-dd

Currently the user signature is hardwired into date-and-sign.el
Not a good solution. How about:

    environment variable: DINKUM_USER_EMAIL
    if it doesn't exist, use 
        environment variable: USER

NOTE WELL: These definitions must be in .profile (NOT .bashrc) otherwise
the gnome apps won't see them.  i.e. if emacs is launched from icon rather
than terminal... It won't see a DINKUM_USER_EMAIL created in .bashrc

<todo> Create the emacs readme.txt file
<todo> migrate the emacs out of subversion

2016-11-21 tc@dinkumsoftware.com

Found a nice bash script which automagically shortens the prompt when directory name is too long.

https://gist.github.com/ehamberg/1197104

Single bash function and alteration of PS definition.

Initial implementation (copy of script under ~) so don't need
sudo to install.

deployed:
~/.bashrc                      # Modified
~/.dinkum/bash/dinkum-bashrc   # Copied
               dynpath.bash    # Copied

git:
dinkum/bash/README.txt
            dinkum-bashrc
            dynpath.bash
            /bin/
               dinkum-install-bash-addons

Default setting
tom@toms-pc:~/projects/dinkum/bash$ echo $PS1
PS1:
\[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\u@\h:\w\$


tom@toms-pc /home/tom $ 
PS1:
\u@\h $(_dynpath) $

It's buggy. Get unprintable chars in the prompt.
Commit, and removed from .bashrc until one can debug it.

2016-11-22 tom@rail-pod.com

Debugging dynpath.
Explanation of what's there.
http://askubuntu.com/questions/404341/where-can-i-find-a-complete-reference-for-the-ps1-variable
\[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\u@\h:\w\$
    \w is current working directory
    the first \w shows up in terminal title
    the 2nd \w should be replaced with _dynpath.


Still get unprintable chars when it chops the path.
Wants to output special char: ...
    Horizontal ellipsis
    &#133
    &#x85
    octal: 205
    &hellip

Could NOT get them to print.
don't even know what character set they are

Fixed a ~ problem.
Replaced ... with -
code goes into infinite loop when get deep.

2016-11-24 tc@DinkumSoftware.com

Wanted to put google contacts in chrome web launch page.
Well according to:
    http://www.computerworld.com/article/2475118/internet/how-to-customize-google-s-new-web-app-launcher.html

You have to download an app from chrome  web store:
    app Launcher Customizer for Google

    http://redirect.viglink.com/?format=go&jsonp=vglnk_148001401034511&key=f6962bb9927d153082cdc6b572121599&libId=ivwq0rze010113ap000DAbjj22pm9&loc=http%3A%2F%2Fwww.computerworld.com%2Farticle%2F2475118%2Finternet%2Fhow-to-customize-google-s-new-web-app-launcher.html&v=1&out=https%3A%2F%2Fchrome.google.com%2Fwebstore%2Fdetail%2Fapp-launcher-customizer-f%2Fponjkmladgjfjgllmhnkhgbgocdigcjm&ref=https%3A%2F%2Fwww.google.com%2F&title=How%20to%20customize%20Google%27s%20new%20Web%20app%20launcher%20%7C%20Computerworld&txt=App%20Launcher%20Customizer%20for%20Google

I installed it, but it didn't work., It says:
    Please keep in mind the extension doesn't modify the Chrome App Launcher, only the Google App Launcher
I deleted it.

It lets you configure the apps on a GOOGLE site that has 3x3 bar on right side of page.
which already has contacts in it.
Could NOT find a way to configure the 3x3 Apps button in google chrome on left side of page.
punt.


2016-11-25 tc@DinkumSoftware.com

Tried the scanner at home:
    homephotosmart.dinkumsoftware.com
    10.23.0.150
It used to work on prior orphan ubuntu 14.04

sane-find-scanner

It can't find the scanner.
Some ubuntu help said run hp-setup.
All that did was set up a printer. (I think). I cancelled out.

There's a way to serve a local scanner that sane will find.
That's not what I have, I have scanner directly on network via wifi.
Try it anyway.
    
etc/sane.d/net.conf is the config file.
uncomment and lower connect_time to 15
add 10.23.0.150 to bottom of file.

As kind of expected, didn't work.

Another link with same problem
https://answers.launchpad.net/ubuntu/+question/230672
Said to upgrade hplib and run it.

I guess I should try the hplib that I have and see
if that fixes it.  Will probably make a new printer.

hp-setup
    network/ethernet
    Advanced Settings
    Manual discovery
    homephotosmart.dinkumsoftware.com

    unclick Fax setup
    Printername HomePhotosmart_C2700

created a system print.
printed a test page sucessfully printed test page from hp-setup

simple scan found the scanner. ... joy joy

Delete the other printer
and rename new one  home-photosmart
Printed from an app and it works.

2016-11-27 tc@DinkumSoftware.com

Go back and fix up prompt shorting code.

First get the infrastructure right:

git:
dinkum/
    bash-addons/
        README.txt
        dinkum-bashrc
        bin/
            dinkum-install-bash-addons
        dynpath/
            README.txt
            bin/
                dinkum-install-dynpath
                dinkum-dynpath.bash

deployed:
~/.bashrc                                      # Modified
~/.dinkum/bash-addons/bin/
                          dinkum-bashrc        #  Copied
                     README.txt                #  Copied
                     dynpath/
                         README.txt            #  Copied
                         bin/
                             dinkum-dynpath.bash  # Copied

Get the files renamed and in the right place in git.
diverted to git/bin/git-root-dir

2016-11-28 tc@DinkumSoftware.com

<todo> make and install-tc to put . at head of the path.
<todo> emacs: separate out tc versus other useful functions.
              Maybe thin out overwritten keys
              Maybe document what was in the key overwritten.

Wrote and tested git-root-dir

Wrote, tested, and commited dinkum-install-dynpath

General flow of what to do next:
    debug dynpath()
    integrate with bash-addons
    refactor dinkum-install-dynpath

<todo> understand 'man gitrevisions' and summarize in git-cheatsheet.

2016-12-06 tom@rail-pod.com

<done>  disappear dinkum/bash
        rename dinkum/bash-addons ==> bash

2016-12-09 tc@DinkumSoftware.com

Debugging dynpath....
Sort of seems to work.

Was having a hardtime testing it under git, because
code assumes ~/.dinkum/... I was running under ~projects/dinkum

So I need a way to run under git, even if .dinkum is installed.

Flow:
  ~/.bashrc  : if -e .dinkum/bin/dinkum-bashrc then source it


To test:
DINKUM_DEBUGGING_FROM_GIT=1 bash

dinkum-bashrc examines DINKUM_DEBUGGING_FROM_GIT and points things
to gitrootdir instead of ~/.dinkum
<todo> document this someplace.

So...
x  push ae4efbdbb996f4643b84a17d6f1e54c8e70c19ba
x  shuffle files around
   dinkum-install-from-git          <<< Resume here. Mostly done
      Does dinkum-bashrc only
  Debug dynflow under git
  install dynflow and test under .dinkum


2016-12-11 tc@DinkumSoftware.com
Diversion.  Straighten out the backups.

mounted on bert:
    /mnt/1-t          ; 1 terabyte, vertical black
    /mnt/half-t-top   ; 500G, horizontal gray, on top
    /mnt/molly-bottom ; 500G, horizontal gray, on bottom
                      ; her old backup, read-only

Get errors:

/mnt/1-t
Dec 11 09:32:19 bert kernel: [18299982.457598] EXT4-fs warning (device sde1): __ext4_read_dirblock:901: error reading directory block (ino 34766849, block 0)

Got errors on the other ones also.

I suspect the usb hub.
Unplug the hub ; plug 1-t directly into bert.
Seems ok.
Ran fsck on it.  Saw no errors.  Did brief read and seemed ok.

put half-t-top on other usb port and fsck it.


Bert has two usbs... so leave molly unplugged and plug in
1-5 and half-t-top

Seems ok.




/mnt/half-t-top   ; 500G, horizontal gray, on top
                  ; used: 117G 
    should-be-deleted-but-cant               ; DELETED
                                             ; had some orphan fedora7 2013 stuff
    final-root-rsync-push                    ; DELETED
        orphan-fedora7-2013-01-07-partial.1
        orphan-fedora7-2013-01-07-partial.2
        orphan-fedora7-2014-01-07
                                             ; empty, 500G available


/mnt/1-t          ; 1 terabyte, vertical black
                  ; used: df: 689G  du: 641G

* ===> deleteable


lost-email-related-backups
        orphan-with-lost-tc-email-2009-12-07

manual-backups
    * blinky
    * henrietta
        henrietta-final-manual-backup-2007dec16
    * luna
        luna-final-after-noboot-2011-10-20
        luna-final-fc1-2008-07-23
    molly

svn-recovery *
        svnadmin-dump-0-to-1057.dump

topdir-root-rsync-push
    bert       2015-01-05 16:18:57 newer, cpy into com/dinkumsoftware/
    luna
    orphan     2016-06-12 22:51:40 newr, cpy into com/dinkumsoftware/
    com/dinkumsoftware/
        bert   2011-10-13 19:23:34.
        ernie  2016-05-10 17:19:05
        nellie 2014-03-23 19:59:30  &FINAL&

I suspect the two different ones are when switched to ubuntu
doesn't report fully qualified domain name.
In dinkum-root-rsync-push: need to change:
   hostname ==> hostname --fqdn

Run it on casey to ~tc/play
sudo <path-to-program>/dinkum-root-rsync-pushd localhost /home/tc/play


on casey: with 
    /etc/ssh/sshdconfig:
    PermitRootLogin yes
    PasswordAuthentication yes

 ssh root@localhost    # Works (because pushed the key)
 sudo ssh localhost fails  # asks for passwd n times an dies
                           # suspect security beyond ssh
                           # is preventing root login's


root had no ssh key.
Try duplicating tc's
*   sudo su
    cd /root/.ssh
    ln -s ~tc/.ssh/id_rsa
    ln -s ~tc/.ssh/id_rsa.pub

works.... but it asks for pass phrase.

    sudo su
    cd /root/.ssh
    cp --preserve=mode ~tc/.ssh/id_rsa* .

Still asks for pass phrase.
Go back to symlinks when working, don't forgot to document in casey setup <done>

   sudo su
   eval ($ssh-agent)
   ssh-add

https://ubuntuforums.org/archive/index.php/t-845490.html
OK, I'm now understanding what you're trying to do. Try this:

1) Add "env_keep=SSH_AUTH_SOCK" to your Defaults in /etc/sudoers.
So you would run "sudo visudo" and change your Defaults line to look something like:


    Defaults	!lecture,tty_tickets,!fqdn,env_keep=SSH_AUTH_SOCK


The above is based on the Defaults line from my Hardy system. Yours may look slightly different.

2) Use "ssh-add" to add keys to your keyring as your normal user ID (no need for sudo at this stage).

3) Execute your "sudo rsync ..." (or "sudo ssh ..." or whatever) and it should get the keys from your normal ssh-agent process and not prompt you for your passphrase.

What's going on here is that SSH_AUTH_SOCK is the environment variable that tells SSH processes (or rsync running over SSH) how to communicate with the ssh-agent process and get keys. sudo normally suppresses environment variables like this when you run a command like rsync via sudo, but the env_keep setting tells sudo to propagate this variable into the environment of the process you're running.

I suspect that if things were working for you on earlier releases of Ubuntu it was because the sudo program in the default package was compiled with env_reset option turned off by default. But it's most definitely turned on in my Hardy system at least:

Put it etc/sudoers.d/
    dinkum-allow-sudo-ssh

That fixed it. <todo> move this file into dinkum somewhere.
Took out the symbolic links.



/mnt/1-t/topdir-root-rsync-push/com/dinkumsoftware/
    bert      done
    ernie     done
    luna      punt
    orphan    done move to final
    casey     started.


It was going so well.  It failed on bert because tc has
no ssh credentials there. bert is unique because disks
are mounted there.  Question: should I gen a new key pair
or copy over the one from casey.

Certainly safer to make a new key-pair.

2016-12-29 tc@DinkumSoftware.com

Got dinkum-install-from-git working (non-recursively)

Now I need to get .bashrc diddled.  Need to move dynpath stuff into its one file.


2017-01-29 tom@rail-pod.com

Life went bad.  On development machine the window spread quit working and I diddled either tweak tool or
unity tweak tool.  Now I couldn't book ehe machine from gui interface.  Infinte loop.  Had to ssh in after
some difficulty.

Jan 29 16:23:18 casey kernel: [ 2894.784071] compiz[5683]: segfault at 7f0079656b5f ip 00007f0079656b5f sp 00007ffcb6ac5258 error 14 in icon-theme.cache[7f97119f5000+260b000]

Jan 29 15:54:54 casey gnome-session[2461]: WARNING: Application 'compiz.desktop' killed by signal 11
Jan 29 15:54:54 casey gnome-session[2461]: WARNING: App 'compiz.desktop' respawning too quickly
Jan 29 15:54:54 casey gnome-session[2461]: CRITICAL: We failed, but the fail whale is dead. Sorry....

fixes from:
http://askubuntu.com/questions/590561/ubuntu-14-04-login-loop-problem
1. Install and run unity reset.
     wget https://launchpad.net/~amith/+archive/ubuntutools/+build/3910667/+files/unity-reset_0.1-8_all.deb
     sudo apt-get install dconf-tools
     dpkg --install unity-reset_0.1-8_all.deb
FAILED: lots of error messages

unity-tweak-tool --reset-unity
    similar error messages.

Mostly complaining about no X11 $DISPLAY.  I'm running these ssh'ed in.

dbus-launch
unity-reset

compiz still crashing

Got to reinstall the desktop
sudo apt-get install --reinstall ubuntu-desktop
FAILED

rm ~/.XAuthority .ICEauthority
FAILED
Jan 29 16:33:05 casey kernel: [   30.807864] traps: compiz[2326] general protection ip:7fc7a87f7ecf sp:7ffc15f770c8 error:0 in libscale.so[7fc7a87db000+27000

Made a new user and could log in just fine.

2017-01-30 tom@rail-pod.com

Rather than try to fix it, make a new user and copy over ~tc

1. deluser foo (1000:1000)
   confirm /home/foo still around
   rm -/rf /home/foo

2. 
  adduser backdoor (same password)  1000:1000
  sudo usermod -aG sudo username

3. ssh in to backdoor
   confirm gui boot
   confirm sudo usage

4. deluser tc 1001:1001

5. mv /home/tc  /home/home-tc-before-deleting

6. 
  adduser tc (same password) should be 1001:1001
  sudo usermod -aG sudo username

7/ verify can ssh in
   verify boots
   mv /home/home-tc-before-deleting ~tc/home-tc-before-deleting

8. mv all non .* files from home-tc-before-deleting to ~
   For dot files mv:
       .ssh .emacs

9. go thru casey setup.  DO NOT do tweaks.


NOTE: in home-tc-before-deleting found a root owned file:
      ~/.cache/dconf
than tc couldn't read.  It had a single entry user.
Deleted it, but tc still wouldn't boot.

<todo> delete ~backdoor/tc-before-deleting 45G

New tc account seems up and running.
Rather than reconfigure Thunderbird, just copied in the profile:
    ~/.thunderbird
It seemed to work.  I probably ought to take this opportunity to get
all the mail off of nellie/orphan:
    mail
    address books
Then I can finish up the retirement of nellie/orphan.
There are various addons that should make it easier.

2017-02-06 tc@DinkumSoftware.com

Finish up the retirement of nellie/orphan:
x   move files over
x   move mail over
       x mail
       x address lists
    move bookmarks over

x   Get ernies files to bert. done.
x   moved rsync backups to final.ernie.fedora.


Ernie's eth0 wasn't up.... hum?  Ignore, will be upgrading to ubuntu soon.
apt-get upgrade'd bert/luna.

Bert stores everything:
    ~tc/network-services
        svn

do-release-upgrade
    luna, didn't want to run under ssh.
    Do it native in the basement.


Moved the mail with thunderbird addon:
     ImportExportTools 
     https://freeshell.de/~kaosmos/mboximport-en.html
Kindof klunky but worked.
Export: export folder with subfolders (with structure)
Import: "import mbox file" ; with its/their subdirectory.
        select the mbox file (NOT *.sbd directory)

<done> move this dinkum/thunderbird/thunderbird-tips.txt
       along with downloaded adds-on.

       .thunderbird/pref.js
           has *.mab info
           don't edit manualy while running, be overwritten
           Edit Preferences Config_Editor will let you edit it.

                               
        
